# This file is generated by GitLab CI
test:
  script:
  - git submodule update --init
  - mvn -U clean
  - find ~/.m2/ -name "*.lastUpdated" | xargs rm -f
  - mvn test
  - sonar-runner
  tags: 
  except:
  - tags

deploy:
  script:
  - git submodule update --init
  - find ~/.m2/ -name "*.lastUpdated" | xargs rm -f
  - version=$(echo "cat //*[local-name()='project']/*[local-name()='version']/text()" | xmllint --shell pom.xml | sed '/^\/ >/d' | sed 's/<[^>]*.//g' | sed '/^ ---/d')
  - pkg="eiss-new-$version.war"
  - if ! [[ -n $version ]]; then
  -  'echo "error: cannot find version number"'
  -   exit 1
  - fi
  - mvn -U clean
  - mvn
  - if ! [ -f target/$pkg ]; then
  -  'echo "errror: cannot find package $pkg"'
  -   exit 1
  - fi
  type: deploy
  tags: 
  only:
  - tags